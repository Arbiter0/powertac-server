<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/layouts/visualizer/master.xhtml">

	<ui:define name="title">Wholesale market</ui:define>

	<ui:define name="headIncludes">

		<script type="text/javascript">
		var beforeClearingWholesaleGraph;
		var afterClearingWholesaleGraph;
			
		</script>

	</ui:define>

	<ui:define name="content">

		<p:layout fullPage="false" style="width:800px;height:800px" stateful="true">

			<p:layoutUnit position="west" size="270" collapsible="true"
				header="LOL" styleClass="custom">
				<h:form id="wholesaleTableForm">

					<p:dataTable var="market" value="#{wholesaleBean.markets}"
						paginator="true" rows="15" pageLinks="3" tableStyle="width:auto">

						<f:facet name="header">  
          				   Expand rows to see detailed information  
     			   </f:facet>

						<p:column style="width:20px">
							<p:rowToggler />
						</p:column>

						<p:column style="width:70px" headerText="Name">
							<h:outputText value="#{market.name}" />
						</p:column>

						<p:column style="width:50px" headerText="TTQ (MWh)">
							<h:outputText value="#{market.totalTradedQuantityMWh}" />
						</p:column>

						<p:rowExpansion>

							<p:dataTable var="snapshot" value="#{market.snapshots}"
								tableStyle="width:auto">

								<p:column style="width:60px">
									<h:outputText value="#{snapshot.name}" />
								</p:column>

								<p:column style="width:40px">
									<h:outputText value="#{snapshot.totalTradedQuantity}" />
								</p:column>

								<p:column style="width:40px">
									<h:panelGrid columns="3" styleClass="actions" cellpadding="2">
										<p:commandButton id="selectButton"
											update=":wholesaleGraphsForm" icon="ui-icon-search"
											title="View">
											<f:setPropertyActionListener value="#{snapshot}"
												target="#{wholesaleBean.selectedSnapshot}" />
										</p:commandButton>
									</h:panelGrid>
								</p:column>

							</p:dataTable>

						</p:rowExpansion>
						<f:facet name="footer">
						Total traded quantity: #{wholesaleBean.totalTradedQuantityMWh} MWh
						</f:facet>
					</p:dataTable>

				</h:form>

			</p:layoutUnit>

			<p:layoutUnit position="center" id="wholesaleCenterUnit">
				<h:form id="wholesaleGraphsForm">

					<p:panel rendered="#{not empty wholesaleBean.selectedSnapshot}">
						<!-- Before clearing graph -->
						<div id="beforeClearingWholesaleGraph"
							style="width: 600px; height: 250px;" />
						<script type="text/javascript">
							if (window.beforeClearingWholesaleGraph != null) {
								window.beforeClearingWholesaleGraph.destroy();
							}
							window.beforeClearingWholesaleGraph=$.jqplot('beforeClearingWholesaleGraph',  #{wholesaleBean.selectedSnapshot.wholesaleSnapshotJSON.graphDataBeforeClearing}, 
									{
									title: 'Before clearing graph', 
									seriesColors: #{wholesaleBean.selectedSnapshot.wholesaleSnapshotJSON.seriesColorsBeforeClearing},
									axesDefaults: {
									        labelRenderer: $.jqplot.CanvasAxisLabelRenderer},
									axes: {
										xaxis: {
									            label: "Quantity/MWh",
									            pad: 0,
									            max: 150,
									            min: 0
									            },
									    yaxis: {
									            label: "Price[&euro;]/MWh"},
									            max: 120,
									            min: 0
									            },
									   
																	
											
									seriesDefaults: {
										showMarker: false
									}
								}); 	
						
								</script>


					</p:panel>

					<p:panel rendered="#{not empty wholesaleBean.selectedSnapshot}">

						<!-- After clearing graph -->
						<div id="afterClearingWholesaleGraph"
							style="width: 600px; height: 250px;"></div>
						<script type="text/javascript">
							if (window.afterClearingWholesaleGraph != null) {
								window.afterClearingWholesaleGraph.destroy();
							}
							window.afterClearingWholesaleGraph=$.jqplot('afterClearingWholesaleGraph',  #{wholesaleBean.selectedSnapshot.wholesaleSnapshotJSON.graphDataAfterClearing}, 
									{
									title: 'After clearing graph', 
									seriesColors: #{wholesaleBean.selectedSnapshot.wholesaleSnapshotJSON.seriesColorsAfterClearing},
									axesDefaults: {
									        labelRenderer: $.jqplot.CanvasAxisLabelRenderer},
									axes: {
										xaxis: {
								            label: "Quantity/MWh",
								            pad: 0,
								            max: 150,
								            min: 0
								            },
								    yaxis: {
								            label: "Price[&euro;]/MWh"},
								            max: 120,
								            min: 0
								            },
								   
																	
											
									seriesDefaults: {
										showMarker: false
									}
								}); 	
						
								</script>

					</p:panel>

					<p:panel rendered="#{not empty wholesaleBean.selectedSnapshot}">

						<h:panelGrid columns="2">

							<h:panelGrid columns="2">
								<p:dataTable var="ask"
									value="#{wholesaleBean.selectedSnapshot.beforeAsks}"
									scrollable="true" scrollHeight="120" style="float:left">
									<f:facet name="header">
							Before Asks
							</f:facet>
									<p:column headerText="Limit price" style="width:50px">
										<h:outputText value="#{ask.limitPrice}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
									</p:column>
									<p:column headerText="MWh" style="width:50px">
										<h:outputText value="#{ask.MWh}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
									</p:column>
								</p:dataTable>

								<p:dataTable var="bid"
									value="#{wholesaleBean.selectedSnapshot.beforeBids}"
									scrollable="true" scrollHeight="120" style="float:left">
									<f:facet name="header">
							Before Bids
							</f:facet>
									<p:column headerText="Limit price" style="width:50px">
										<h:outputText value="#{bid.limitPrice}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
									</p:column>
									<p:column headerText="MWh" style="width:50px">
										<h:outputText value="#{bid.MWh}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
									</p:column>
								</p:dataTable>
							</h:panelGrid>

							<h:panelGrid columns="2">
								<p:dataTable var="ask"
									value="#{wholesaleBean.selectedSnapshot.afterAsks}"
									scrollable="true" scrollHeight="120" style="float:left">
									<f:facet name="header">
							After Asks
							</f:facet>
									<p:column headerText="Limit price" style="width:50px">
										<h:outputText value="#{ask.limitPrice}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
									</p:column>
									<p:column headerText="MWh" style="width:50px">
										<h:outputText value="#{ask.MWh}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
									</p:column>
								</p:dataTable>

								<p:dataTable var="bid"
									value="#{wholesaleBean.selectedSnapshot.afterBids}"
									scrollable="true" scrollHeight="120" style="float:left">
									<f:facet name="header">
							After Bids
							</f:facet>
									<p:column headerText="Limit price" style="width:50px">
										<h:outputText value="#{bid.limitPrice}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
									</p:column>
									<p:column headerText="MWh" style="width:50px">
										<h:outputText value="#{bid.MWh}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
									</p:column>
								</p:dataTable>
							</h:panelGrid>

							<h:panelGrid>

								<h:panelGrid columns="4"
									rendered="#{not empty wholesaleBean.selectedSnapshot.marketBidOrder}">
									<h:outputLabel value="Market bid order: " />
									<h:outputText
										value="#{wholesaleBean.selectedSnapshot.marketBidOrder.MWh}">
										<f:convertNumber maxFractionDigits="2" />
									</h:outputText>
									<h:outputText value=" @ " />
									<h:outputText
										value="#{wholesaleBean.selectedSnapshot.marketBidOrder.limitPrice}"
										rendered="#{not empty wholesaleBean.selectedSnapshot.marketBidOrder}">
										<f:convertNumber maxFractionDigits="2" />
									</h:outputText>

								</h:panelGrid>

								<h:panelGrid columns="4"
									rendered="#{not empty wholesaleBean.selectedSnapshot.marketAskOrder}">
									<h:outputLabel value="Market ask order: " />
									<h:outputText
										value="#{wholesaleBean.selectedSnapshot.marketAskOrder.MWh}">
										<f:convertNumber maxFractionDigits="2" />
									</h:outputText>
									<h:outputText value=" @ " />
									<h:outputText
										value="#{wholesaleBean.selectedSnapshot.marketAskOrder.limitPrice}"
										rendered="#{not empty wholesaleBean.selectedSnapshot.marketAskOrder}">
										<f:convertNumber maxFractionDigits="2" />
									</h:outputText>

								</h:panelGrid>
								<h:panelGrid columns="2">
									<h:outputLabel value="Total Traded Quantity: " />
									<h:outputText
										value="#{wholesaleBean.selectedSnapshot.totalTradedQuantity} MWh" />
								</h:panelGrid>


							</h:panelGrid>
						</h:panelGrid>

					</p:panel>



				</h:form>
			</p:layoutUnit>


		</p:layout>



	</ui:define>

</ui:composition>