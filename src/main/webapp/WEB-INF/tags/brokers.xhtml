<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">


<h:body>
	<ui:fragment>

		<ui:repeat var="broker" value="#{brokersClone}">
			<script type="text/javascript">
	var cashChart#{broker.id}=null;
	var energyChart#{broker.id}=null;
	var customerSharesBarhChart#{broker.id}=null;
	
	var cashLineChartDaily#{broker.id}=null;
	var energyLineChartDaily#{broker.id}=null;
	
	var cashLineChartDailyAVG#{broker.id}=null;
	var energyLineChartDailyAVG#{broker.id}=null;
	
	var cashLineChartCurrentDay#{broker.id}=null;
	var energyLineChartCurrentDay#{broker.id}=null;
	
	var customersBubble#{broker.id}=null;
	
	</script>
		</ui:repeat>


		<p:tabView id="tabBrokers" var="broker" value="#{brokersClone}"
			dynamic="true" cache="true">

			<p:tab title="#{broker.name}">



				<table cellspacing="10">
					<tr>
						<td><p:graphicImage value="${broker.appearance.iconLocation}"
								width="65" height="65" /></td>
						<td><table cellspacing="10">
								<tr>
									<th><h:outputText value="Cash balance:"
											style="font-weight:normal" /></th>
									<th><h:outputText value="Energy balance:"
											style="font-weight:normal" /></th>
									<th><h:outputText value="Subscription count:"
											style="font-weight:normal" /></th>
								</tr>
								<tr>
									<td><h:outputText value="#{broker.cashBalance}"
											style="font-weight: bold">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText>
										<h:outputText value=" &euro;"
											style="font-weight: bold"/></td>
									<td><h:outputText value="#{broker.energyBalance}"
											style="font-weight: bold">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText><h:outputText value=" kWh"
											style="font-weight: bold"/></td>
									<td><h:outputText value="#{broker.customerCount}"
											style="font-weight: bold">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText></td>
								</tr>
							</table></td>
					</tr>
				</table>

				<p:tabView dynamic="true" cache="true">
					<p:tab title="Cash">

						<p:panel rendered="#{selectedBrokerChartsBean.allTimeslots}">
							<!-- Cash line chart for a specific broker (all timeslots)-->
							<div id="cashChart#{broker.id}"
								style="width: 700px; height: 250px"></div>
							<script type="text/javascript">
				
		 			if (window.cashChart#{broker.id}!=null) {
						window.cashChart#{broker.id}.destroy();					
					}
					window.cashChart#{broker.id} = $.jqplot('cashChart#{broker.id}', [ #{broker.json.cashBalanceJson} ],{
						title: 'Cash balance', 
						axesDefaults: {
						        labelRenderer: $.jqplot.CanvasAxisLabelRenderer},
						axes: {
							xaxis: {
						            label: "timeslot",
						            pad: 0},
						    yaxis: {
						            label: "cash/&euro;"}},
						seriesDefaults: {
							showMarker: false
						},
						
						series:[#{broker.json.seriesOptions}],
						
						}); 
					</script>
						</p:panel>

						<!--....................................................... DAILY VALUES .................................... -->
						<p:panel
							rendered="#{selectedBrokerChartsBean.dailyValues and not empty broker.json.cashBalanceDailyJson}">
							<!-- Cash line chart for a specific broker (end of day values)-->
							<div id="cashLineChartDaily#{broker.id}"
								style="width: 700px; height: 250px"></div>
							<script type="text/javascript">
				
		 			if (window.cashLineChartDaily#{broker.id}!=null) {
						window.cashLineChartDaily#{broker.id}.destroy();					
					}
					window.cashLineChartDaily#{broker.id} = $.jqplot('cashLineChartDaily#{broker.id}', [ #{broker.json.cashBalanceDailyJson} ],{
						title: 'Daily Cash balance', 
						axesDefaults: {
						        labelRenderer: $.jqplot.CanvasAxisLabelRenderer},
						axes: {
							xaxis: {
						            label: "day",
						            pad: 0},
						    yaxis: {
						            label: "cash/&euro;"}},
						seriesDefaults: {
							showMarker: false
						},
						
						series:[#{broker.json.seriesOptions}],
						
						}); 
					</script>
						</p:panel>


						<p:panel
							rendered="#{selectedBrokerChartsBean.currentDayValues and not empty broker.currentDayState.json.dayCashBalancesJson}">
							<!-- Cash line chart for a specific broker (Current day)-->
							<div id="cashLineChartCurrentDay#{broker.id}"
								style="width: 700px; height: 250px"></div>
							<script type="text/javascript">
				
		 			if (window.cashLineChartCurrentDay#{broker.id}!=null) {
						window.cashLineChartCurrentDay#{broker.id}.destroy();					
					}
					window.cashLineChartCurrentDay#{broker.id} = $.jqplot('cashLineChartCurrentDay#{broker.id}', [ #{broker.currentDayState.json.dayCashBalancesJson} ],{
						title: 'Current Day Cash balance', 
						axesDefaults: {
						        labelRenderer: $.jqplot.CanvasAxisLabelRenderer},
						axes: {
							xaxis: {
						            label: "timeslot",
						            pad: 0,
							        ticks: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},
						    yaxis: {
						            label: "cash/&euro;"}},
						seriesDefaults: {
							showMarker: false
						},
						
						series:[#{broker.json.seriesOptions}],
						
						}); 
					</script>
						</p:panel>

					</p:tab>

					<p:tab title="Energy">
						<p:panel rendered="#{selectedBrokerChartsBean.allTimeslots}">
							<!-- Energy chart for a specific broker (all timeslots) -->
							<div id="energyChart#{broker.id}"
								style="width: 700px; height: 250px"></div>
							<script type="text/javascript">
				
		 			if (window.energyChart#{broker.id}!=null) {
						window.energyChart#{broker.id}.destroy();
						}
					window.energyChart#{broker.id} = $.jqplot('energyChart#{broker.id}', [ #{broker.json.energyBalanceJson} ],{
						title: 'Energy balance', 
						axesDefaults: {
						        labelRenderer: $.jqplot.CanvasAxisLabelRenderer},
						axes: {
							xaxis: {
						            label: "timeslot",
						            pad: 0},
						    yaxis: {
						            label: "energy/kWh"}},
						seriesDefaults: {
										showMarker: false
										},
						series:[#{broker.json.seriesOptions}]
						
						}); 
				</script>
						</p:panel>

						<!--....................................................... DAILY AVG VALUES .................................... -->
						<p:panel
							rendered="#{selectedBrokerChartsBean.dailyAVGValues and not empty broker.json.energyBalanceDailyAVGJson}">
							<!-- Energy chart for a specific broker (24 timeslot average value) -->
							<div id="energyLineChartDailyAVG#{broker.id}"
								style="width: 700px; height: 250px"></div>
							<script type="text/javascript">
				
		 						if (energyLineChartDailyAVG#{broker.id}!=null) {
								window.energyLineChartDailyAVG#{broker.id}.destroy();
								}
								window.energyLineChartDailyAVG#{broker.id} = $.jqplot('energyLineChartDailyAVG#{broker.id}', [ #{broker.json.energyBalanceDailyAVGJson} ],{
									title: 'Daily Average Energy balance', 
									axesDefaults: {
						    		    labelRenderer: $.jqplot.CanvasAxisLabelRenderer},
										axes: {
											xaxis: {
						 			           label: "day",
						        			    pad: 0},
						  				    yaxis: {
						         			   label: "energy/kWh"}},
									    	seriesDefaults: {
												showMarker: false
											},
										series:[#{broker.json.seriesOptions}]
						
									}); 
							</script>
						</p:panel>

						<!--....................................................... Current day VALUES .................................... -->
						<p:panel
							rendered="#{selectedBrokerChartsBean.currentDayValues and not empty broker.currentDayState.json.dayEnergyBalancesJson}">
							<!-- Energy chart for a specific broker (24 timeslot average value) -->
							<div id="energyLineChartCurrentDay#{broker.id}"
								style="width: 700px; height: 250px"></div>
							<script type="text/javascript">
				
		 						if (energyLineChartCurrentDay#{broker.id}!=null) {
								window.energyLineChartCurrentDay#{broker.id}.destroy();
								}
								window.energyLineChartCurrentDay#{broker.id} = $.jqplot('energyLineChartCurrentDay#{broker.id}', [ #{broker.currentDayState.json.dayEnergyBalancesJson} ],{
								title: 'Current Day Energy balance', 
								axesDefaults: {
						        labelRenderer: $.jqplot.CanvasAxisLabelRenderer},
								axes: {
									xaxis: {
						        	    label: "timeslot",
						            	pad: 0,
								        ticks: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},
						 	   		yaxis: {
							       		label: "energy/kWh"}},
									seriesDefaults: {
										showMarker: false
										},
								series:[#{broker.json.seriesOptions}]
						
								}); 
							</script>
						</p:panel>
					</p:tab>

					<p:tab title="Customers">


						<table style="margin-left: auto; margin-right: auto;">
							<tr>
								<td>
									<!-- Customers bubble chart for a specific broker  -->
									<div id="customersBubble#{broker.id}"
										style="width: 750px; height: 450px" />
								</td>
								<td><div style="height: 340px;">
										<table id="customersBubbleTable#{broker.id}"
											class="bubbleTable">
											<tr>
												<th>Customer</th>
												<th>Subscription count</th>
												<th>Total energy [kWh]</th>
												<th>Total cash [&euro;]</th>
											</tr>
										</table>
									</div></td>
							</tr>
						</table>

						<script type="text/javascript">
				
		 						if (customersBubble#{broker.id}!=null) {
								window.customersBubble#{broker.id}.destroy();
								}
		 						var arr = #{broker.json.customersBubbleJson};                                          
                                           
								window.customersBubble#{broker.id} = $.jqplot('customersBubble#{broker.id}',[arr],{
								                                                            title: 'Customers',
								                                                            seriesDefaults:{
								                                                              renderer: $.jqplot.BubbleRenderer,
								                                                              rendererOptions: {
								                                                                bubbleAlpha: 0.6,
								                                                                highlightAlpha: 0.8,
								                                                                showLabels: true
								                                                              },
								                                                              shadow: true,
								                                                              shadowAlpha: 0.05
								                                                            },
								                                                            axes:{
								                                                                xaxis:{
								                                                                  label:'cash/&euro;',
								                                                                  labelRenderer: $.jqplot.CanvasAxisLabelRenderer
								                                                                },
								                                                                yaxis:{
								                                                                  label:'energy/kWh',
								                                                                  labelRenderer: $.jqplot.CanvasAxisLabelRenderer
								                                                                }
								                                                              }
								                                                          });
								 $.each(arr, function(index, val) {
									    $('#customersBubbleTable#{broker.id}').append('<tr><td>'+val[3]+'</td><td>'+val[2]+'</td><td>'+val[1]+'</td><td>'+val[0]+'</td></tr>');
									  });
								 
								 
							
								 
								
								
								
							</script>


					</p:tab>

				</p:tabView>






				<p:bubbleChart rendered="false" xaxisAngle="30" />



			</p:tab>

		</p:tabView>




	</ui:fragment>
</h:body>

</html>

